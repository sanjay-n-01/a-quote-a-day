<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>A Quote A Day</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=UnifrakturMaguntia&family=IM+Fell+English:ital@0;1&family=Raleway:wght@300;400;600;700&family=DM+Mono:wght@300;400&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap" rel="stylesheet" crossorigin="anonymous"/>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  /* PWA design system â€” matching your existing app */
  --obsidian: #ffffff;
  --deep:     #faf7f2;
  --surface:  #ffffff;
  --surface2: #f5efe6;

  --gold:       #c9a84c;
  --gold-light: #e8c97a;
  --gold-dim:   rgba(201,168,76,0.12);
  --gold-border: rgba(201,168,76,0.35);

  --crimson:    #7A0019;

  --text:       #2a2a2a;
  --text-muted: #7a766f;
  --text-dim:   #b0a99f;

  --border:     rgba(0,0,0,0.06);
  --border-gold: rgba(201,168,76,0.35);
  --shadow-sm:  0 2px 8px rgba(0,0,0,0.06);
  --shadow-md:  0 8px 24px rgba(0,0,0,0.08);
  --shadow-gold: 0 8px 24px rgba(201,168,76,0.18);

  --serif: 'Playfair Display', Georgia, serif;
  --mono:  'DM Mono', monospace;
  --sans:  'Raleway', sans-serif;
  --fraktur: 'UnifrakturMaguntia', serif;

  /* Aliases for share card / legacy refs */
  --ink:        var(--text);
  --ink-mid:    #4a3f2e;
  --ink-light:  var(--text-muted);
  --paper:      var(--surface);
  --paper-dark: var(--surface2);
  --rule:       var(--border);
  --rule-heavy: rgba(0,0,0,0.15);
  --red:        var(--crimson);
}

html { scroll-behavior: smooth; }

body {
  background: var(--deep);
  color: var(--text);
  font-family: var(--sans);
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}

/* subtle ambient gold glow â€” matches your PWA */
body::after {
  content: '';
  position: fixed;
  top: -20%; left: -10%;
  width: 60vw; height: 60vw;
  background: radial-gradient(circle, rgba(201,168,76,0.07), transparent 70%);
  pointer-events: none;
  z-index: 0;
  animation: breathe 12s ease-in-out infinite;
}
@keyframes breathe {
  0%,100% { transform: scale(1); opacity: 0.5; }
  50%      { transform: scale(1.1); opacity: 1; }
}

/* â”€â”€â”€ MASTHEAD â”€â”€â”€ */
.masthead {
  background: rgba(255,255,255,0.92);
  backdrop-filter: blur(18px);
  border-bottom: 1px solid var(--border);
  text-align: center;
  padding: 16px 20px 0;
  position: sticky;
  top: 0;
  z-index: 50;
  box-shadow: var(--shadow-sm);
}

.masthead-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-family: var(--mono);
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-dim);
  padding-bottom: 10px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 8px;
}

.masthead-dateline { color: var(--text-muted); }
.masthead-edition {
  background: linear-gradient(135deg, var(--gold), var(--gold-light));
  color: white;
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 9px;
  font-family: var(--sans);
  font-weight: 700;
  letter-spacing: 1.5px;
  box-shadow: 0 2px 8px rgba(201,168,76,0.25);
}

.masthead-title {
  font-family: var(--fraktur);
  font-size: clamp(32px, 7vw, 60px);
  color: var(--text);
  letter-spacing: 2px;
  line-height: 1;
  margin-bottom: 2px;
}

.masthead-rule-ornament {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 8px 0;
}
.masthead-rule-ornament::before,
.masthead-rule-ornament::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--gold-border);
}
.masthead-ornament {
  font-size: 14px;
  color: var(--gold);
}

.masthead-tagline {
  font-family: var(--sans);
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 0.5px;
  padding-bottom: 10px;
}

/* â”€â”€â”€ NAV BAR â”€â”€â”€ */
.nav-bar {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  border-top: 1px solid var(--border);
  background: rgba(255,255,255,0.95);
  overflow-x: auto;
  scrollbar-width: none;
  padding: 6px 12px;
}
.nav-bar::-webkit-scrollbar { display: none; }

.nav-item {
  font-family: var(--sans);
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--text-muted);
  padding: 6px 14px;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.2s;
  background: none;
  border: 1px solid transparent;
  border-radius: 20px;
}
.nav-item:hover {
  background: var(--gold-dim);
  color: var(--gold);
  border-color: var(--gold-border);
}
.nav-item.active {
  background: linear-gradient(135deg, var(--gold), var(--gold-light));
  color: white;
  border-color: transparent;
  box-shadow: 0 3px 10px rgba(201,168,76,0.3);
}

/* â”€â”€â”€ LAYOUT â”€â”€â”€ */
.newspaper-body {
  position: relative;
  z-index: 1;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 16px 80px;
}

/* â”€â”€â”€ SECTION LABEL â”€â”€â”€ */
.section-label {
  display: flex;
  align-items: center;
  gap: 0;
  margin: 32px 0 0;
}
.section-label-text {
  font-family: var(--sans);
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: white;
  background: linear-gradient(135deg, var(--gold), var(--gold-light));
  padding: 5px 16px;
  border-radius: 4px 0 0 4px;
}
.section-label-rule {
  flex: 1;
  height: 2px;
  background: var(--gold-border);
}
.section-label-date {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--text-muted);
  padding: 5px 12px;
  border: 1px solid var(--gold-border);
  border-left: none;
  border-radius: 0 4px 4px 0;
  background: var(--surface);
}

/* â”€â”€â”€ TODAY BANNER â”€â”€â”€ */
.today-banner {
  background: linear-gradient(135deg, var(--gold), var(--gold-light));
  color: white;
  text-align: center;
  padding: 8px;
  font-family: var(--sans);
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-top: 0;
  box-shadow: 0 2px 12px rgba(201,168,76,0.3);
}

/* â”€â”€â”€ TODAY HERO QUOTE â”€â”€â”€ */
.today-hero {
  background: linear-gradient(145deg, #ffffff, #f8f2e8);
  border: 1px solid var(--border);
  border-top: 4px solid var(--gold);
  border-radius: 0 0 16px 16px;
  margin-top: 0;
  padding: 32px 36px 28px;
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-gold);
  cursor: pointer;
  transition: all 0.3s;
}
.today-hero:hover {
  box-shadow: 0 16px 40px rgba(201,168,76,0.25);
  transform: translateY(-2px);
}
.today-hero::before {
  content: '"';
  position: absolute;
  top: -10px; left: 20px;
  font-family: var(--serif);
  font-size: 160px;
  line-height: 1;
  color: var(--gold);
  opacity: 0.07;
  user-select: none;
}

.hero-kicker {
  font-family: var(--sans);
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--crimson);
  margin-bottom: 14px;
}

.hero-quote-mark { display: none; } /* handled by ::before */

.hero-quote-text {
  font-family: var(--serif);
  font-size: clamp(20px, 3.2vw, 34px);
  font-weight: 400;
  font-style: italic;
  line-height: 1.5;
  color: var(--text);
  position: relative;
  z-index: 1;
  padding-left: 16px;
  border-left: 3px solid var(--gold);
  margin-bottom: 20px;
}

.hero-byline {
  font-family: var(--serif);
  font-size: clamp(22px, 3.2vw, 34px);
  font-weight: 900;
  color: var(--text);
  letter-spacing: 0.2px;
  line-height: 1.1;
  margin-top: 18px;
}
.hero-byline strong {
  font-weight: 900;
}

/* Hero student name â€” secondary below author */
.hero-student-name {
  font-family: var(--serif);
  font-size: clamp(16px, 2vw, 22px);
  font-weight: 700;
  color: var(--text-muted);
  letter-spacing: 0.2px;
  margin-top: 6px;
}
.hero-student-dept {
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: var(--gold);
  margin-top: 3px;
}

.hero-about {
  margin-top: 14px;
  font-family: var(--sans);
  font-size: 14px;
  font-style: italic;
  line-height: 1.65;
  color: var(--text-muted);
  padding-top: 14px;
  border-top: 1px solid var(--border);
}

.hero-contrib { display: none; } /* replaced by hero-student-name */

/* â”€â”€â”€ COLUMN GRID â”€â”€â”€ */
.col-grid {
  display: grid;
  gap: 14px;
  padding: 14px;
  background: transparent;
  border: none;
}
.col-grid.cols-1 { grid-template-columns: 1fr; }
.col-grid.cols-2 { grid-template-columns: 1fr 1fr; }
.col-grid.cols-3 { grid-template-columns: 1fr 1fr 1fr; }
.col-grid.cols-4 { grid-template-columns: 1fr 1fr 1fr 1fr; }

/* â”€â”€â”€ QUOTE CARD â€” elevated, clearly separated â”€â”€â”€ */
.q-card {
  background: linear-gradient(145deg, #ffffff, #f8f2e8);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 22px 22px 18px;
  position: relative;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(.4,0,.2,1);
  display: flex;
  flex-direction: column;
  box-shadow: var(--shadow-sm);
  overflow: hidden;
}
.q-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--gold), var(--gold-light));
  border-radius: 16px 16px 0 0;
  opacity: 0;
  transition: opacity 0.3s;
}
.q-card:hover {
  border-color: var(--gold-border);
  box-shadow: var(--shadow-gold);
  transform: translateY(-3px);
}
.q-card:hover::before { opacity: 1; }

.q-card-num {
  font-family: var(--mono);
  font-size: 8px;
  letter-spacing: 1.5px;
  color: var(--text-dim);
  margin-bottom: 10px;
  text-transform: uppercase;
}

.q-card-text {
  font-family: var(--serif);
  font-size: clamp(14px, 1.5vw, 17px);
  font-style: italic;
  line-height: 1.6;
  color: var(--text);
  flex: 1;
  margin-bottom: 16px;
}

.q-card-rule {
  height: 1px;
  background: var(--border);
  margin-bottom: 12px;
}

/* â”€â”€ QUOTED AUTHOR â€” big, prominent â”€â”€ */
.q-card-author {
  font-family: var(--serif);
  font-size: 1.45rem;
  font-weight: 900;
  color: var(--text);
  letter-spacing: 0.2px;
  line-height: 1.1;
}

/* â”€â”€ STUDENT CONTRIBUTOR â€” still visible, secondary â”€â”€ */
.q-card-student-name {
  font-family: var(--serif);
  font-size: 1.15rem;
  font-weight: 700;
  color: var(--text-muted);
  letter-spacing: 0.2px;
  line-height: 1.1;
  margin-top: 4px;
}
.q-card-student-dept {
  font-family: var(--mono);
  font-size: 9px;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: var(--gold);
  margin-top: 3px;
  margin-bottom: 0;
}

.q-card-meta {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--text-dim);
  line-height: 1.4;
  margin-top: 2px;
}

.q-card-about {
  margin-top: 10px;
  font-family: var(--sans);
  font-size: 12px;
  font-style: italic;
  line-height: 1.5;
  color: var(--text-muted);
  padding-top: 10px;
  border-top: 1px solid var(--border);
}

/* â”€â”€â”€ DATE GROUP â”€â”€â”€ */
.date-group { margin-bottom: 0; }

/* â”€â”€â”€ ARCHIVE DATE HEADER â”€â”€â”€ */
.archive-date-header {
  display: flex;
  align-items: stretch;
  margin-top: 28px;
  margin-bottom: 0;
  border-radius: 12px 12px 0 0;
  overflow: hidden;
  border: 1px solid var(--border);
  border-bottom: none;
  box-shadow: var(--shadow-sm);
}
.archive-date-cal {
  background: linear-gradient(135deg, var(--gold), var(--gold-light));
  color: white;
  padding: 12px 18px;
  text-align: center;
  min-width: 70px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.archive-date-cal-month {
  font-family: var(--sans);
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  opacity: 0.85;
}
.archive-date-cal-day {
  font-family: var(--serif);
  font-size: 28px;
  font-weight: 900;
  line-height: 1;
}
.archive-date-cal-year {
  font-family: var(--mono);
  font-size: 8px;
  opacity: 0.65;
  margin-top: 2px;
}
.archive-date-info {
  padding: 12px 18px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 3px;
  background: var(--surface);
  border-left: 1px solid var(--border);
  flex: 1;
}
.archive-date-label {
  font-family: var(--serif);
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
  font-style: italic;
}
.archive-date-sub {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--text-muted);
  letter-spacing: 0.5px;
}

/* â”€â”€â”€ PULL QUOTE â”€â”€â”€ */
.pull-quote {
  background: linear-gradient(145deg, var(--gold-dim), rgba(201,168,76,0.06));
  border: 1px solid var(--gold-border);
  border-radius: 16px;
  border-top: 3px solid var(--gold);
  padding: 24px 28px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: var(--shadow-sm);
}
.pull-quote:hover {
  box-shadow: var(--shadow-gold);
  transform: translateY(-2px);
}
.pull-quote-text {
  font-family: var(--serif);
  font-size: clamp(15px, 2vw, 20px);
  font-style: italic;
  line-height: 1.55;
  color: var(--text);
  margin-bottom: 14px;
}
.pull-quote-attr {
  font-family: var(--sans);
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-muted);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SWIPEABLE DECK VIEWER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.deck-overlay {
  position: fixed;
  inset: 0;
  background: rgba(20,16,10,0.78);
  backdrop-filter: blur(6px);
  z-index: 200;
  display: flex;
  flex-direction: column;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}
.deck-overlay.open { opacity: 1; pointer-events: auto; }

.deck-topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 20px 10px;
  flex-shrink: 0;
  gap: 12px;
}
.deck-close {
  width: 36px; height: 36px;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.18);
  background: rgba(255,255,255,0.08);
  color: rgba(255,255,255,0.8);
  font-size: 16px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s;
  flex-shrink: 0;
}
.deck-close:hover { background: rgba(255,255,255,0.18); color: #fff; }
.deck-counter {
  font-family: var(--mono);
  font-size: 11px;
  color: rgba(255,255,255,0.5);
  letter-spacing: 1.5px;
  flex-shrink: 0;
}
.deck-dots {
  display: flex;
  gap: 6px;
  align-items: center;
  flex-wrap: wrap;
  justify-content: center;
  flex: 1;
}
.deck-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: rgba(255,255,255,0.25);
  cursor: pointer;
  transition: all 0.25s;
}
.deck-dot.active {
  background: var(--gold);
  width: 18px;
  border-radius: 3px;
  box-shadow: 0 0 6px rgba(201,168,76,0.5);
}
.deck-track-wrap {
  flex: 1;
  overflow: hidden;
  position: relative;
}
.deck-track {
  display: flex;
  height: 100%;
  /* width set by JS based on number of slides */
}
.deck-slide {
  flex: 0 0 100vw;
  width: 100vw;
  height: 100%;
  overflow-y: auto;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 10px 16px 20px;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.deck-slide::-webkit-scrollbar { display: none; }
.deck-card {
  background: linear-gradient(145deg, #ffffff, #f8f2e8);
  border-radius: 20px;
  border: 1px solid var(--border);
  border-top: 4px solid var(--gold);
  box-shadow: 0 20px 60px rgba(0,0,0,0.25);
  width: 100%;
  max-width: 560px;
  padding: 28px 26px 24px;
  display: flex;
  flex-direction: column;
  gap: 0;
}
.dc-kicker {
  font-family: var(--mono);
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: var(--crimson);
  margin-bottom: 14px;
}
.dc-quote {
  font-family: var(--serif);
  font-size: clamp(17px, 3.2vw, 24px);
  font-style: italic;
  line-height: 1.55;
  color: var(--text);
  padding-left: 14px;
  border-left: 3px solid var(--gold);
  margin-bottom: 22px;
}
.dc-author-name {
  font-family: var(--serif);
  font-size: clamp(24px, 4.5vw, 34px);
  font-weight: 900;
  color: var(--text);
  line-height: 1.05;
  letter-spacing: 0.2px;
}
.dc-author-role {
  font-family: var(--mono);
  font-size: 8px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-top: 4px;
  margin-bottom: 18px;
}
.dc-contrib-box {
  background: linear-gradient(135deg, var(--gold-dim), rgba(201,168,76,0.04));
  border: 1px solid var(--gold-border);
  border-left: 4px solid var(--gold);
  border-radius: 12px;
  padding: 16px 18px;
  margin-bottom: 20px;
}
.dc-contrib-label {
  font-family: var(--mono);
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: var(--gold);
  margin-bottom: 5px;
}
.dc-contrib-name {
  font-family: var(--serif);
  font-size: clamp(18px, 3.2vw, 24px);
  font-weight: 900;
  color: var(--text);
  line-height: 1.1;
}
.dc-contrib-dept {
  font-family: var(--mono);
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--gold);
  opacity: 0.8;
  margin-top: 4px;
}
.dc-contrib-divider {
  height: 1px;
  background: var(--gold-border);
  margin: 14px 0;
}
.dc-about-label {
  font-family: var(--mono);
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--gold);
  margin-bottom: 7px;
}
.dc-about-text {
  font-family: var(--sans);
  font-style: italic;
  font-size: 13px;
  line-height: 1.7;
  color: var(--text-muted);
}
.dc-actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}
.dc-btn {
  font-family: var(--sans);
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  padding: 9px 14px;
  border: 1.5px solid var(--border);
  background: var(--surface);
  color: var(--text-muted);
  cursor: pointer;
  text-decoration: none;
  border-radius: 20px;
  transition: all 0.2s;
  display: inline-block;
}
.dc-btn:hover { border-color: var(--gold-border); color: var(--gold); background: var(--gold-dim); }
.dc-btn.primary {
  background: linear-gradient(135deg, var(--gold), var(--gold-light));
  color: white;
  border-color: transparent;
  box-shadow: 0 4px 12px rgba(201,168,76,0.3);
}
.dc-btn.primary:hover { filter: brightness(1.06); }
.deck-hint {
  text-align: center;
  padding: 8px 0 4px;
  font-family: var(--mono);
  font-size: 9px;
  letter-spacing: 2px;
  color: rgba(255,255,255,0.3);
  flex-shrink: 0;
}
.deck-arrow {
  position: fixed;
  top: 50%;
  transform: translateY(-50%);
  width: 44px; height: 44px;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.08);
  color: rgba(255,255,255,0.7);
  font-size: 26px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s;
  z-index: 201;
  padding-bottom: 2px;
}
.deck-arrow:hover { background: rgba(255,255,255,0.18); color: #fff; }
.deck-arrow-prev { left: 10px; }
.deck-arrow-next { right: 10px; }
.deck-arrow:disabled { opacity: 0.2; cursor: default; }
@media (max-width: 500px) {
  .deck-arrow { display: none; }
  .deck-card { padding: 22px 18px 20px; }
}

/* â”€â”€â”€ LOADING â”€â”€â”€ */
.loading-page {
  min-height: 60vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
  color: var(--text-muted);
}
.loading-spinner {
  font-family: var(--serif);
  font-size: 48px;
  color: var(--gold);
  animation: pulse 1.8s ease-in-out infinite;
}
@keyframes pulse { 0%,100% { opacity: 0.3; } 50% { opacity: 1; } }
.loading-text {
  font-family: var(--sans);
  font-size: 13px;
  color: var(--text-muted);
  letter-spacing: 1px;
}

/* â”€â”€â”€ EMPTY STATE â”€â”€â”€ */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-muted);
  font-family: var(--sans);
  font-size: 15px;
  border: 2px dashed var(--gold-border);
  border-radius: 16px;
  margin-top: 20px;
  background: var(--gold-dim);
}

/* â”€â”€â”€ FOOTER â”€â”€â”€ */
.site-footer {
  background: var(--text);
  color: rgba(255,255,255,0.5);
  text-align: center;
  padding: 20px;
  font-family: var(--sans);
  font-size: 9px;
  letter-spacing: 3px;
  text-transform: uppercase;
}

/* â”€â”€â”€ SCROLLBAR â”€â”€â”€ */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--surface2); }
::-webkit-scrollbar-thumb { background: rgba(201,168,76,0.35); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--gold); }

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€ */
@media (max-width: 900px) {
  .col-grid.cols-4 { grid-template-columns: 1fr 1fr; }
}
@media (max-width: 768px) {
  .col-grid.cols-3 { grid-template-columns: 1fr 1fr; }
  .col-grid.cols-4 { grid-template-columns: 1fr 1fr; }
  .today-hero { padding: 22px 18px 20px; }
  .modal-body, .modal-header { padding-left: 18px; padding-right: 18px; }
}

@media (max-width: 500px) {
  .col-grid.cols-2,
  .col-grid.cols-3,
  .col-grid.cols-4 { grid-template-columns: 1fr; }
  .masthead-meta { flex-direction: column; gap: 4px; text-align: center; }
  .archive-date-header { flex-direction: row; }
}

/* â”€â”€â”€ STAGGER ANIMATION â”€â”€â”€ */
.q-card, .pull-quote, .today-hero {
  animation: fadeUp 0.45s cubic-bezier(.4,0,.2,1) both;
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to   { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>

<!-- â”€â”€â”€ MASTHEAD â”€â”€â”€ -->
<header class="masthead">
  <div class="masthead-meta">
    <span class="masthead-dateline" id="mastDateline">â€”</span>
    <span class="masthead-edition">Student Edition</span>
    <span id="mastCount" style="font-family:var(--mono);font-size:9px;">â€” quotes</span>
  </div>

  <div class="masthead-title">A Quote A Day</div>

  <div class="masthead-rule-ornament">
    <span class="masthead-ornament">âœ¦</span>
  </div>

  <div class="masthead-tagline">
    Wisdom, wit &amp; wonder â€” collected daily from our students
  </div>

  <nav class="nav-bar">
    <button class="nav-item active" data-view="all">All Editions</button>
    <button class="nav-item" data-view="today">Today</button>
    <button class="nav-item" data-view="authors">By Author</button>
    <button class="nav-item" data-view="departments">By Department</button>
  </nav>
</header>

<!-- â”€â”€â”€ NEWSPAPER BODY â”€â”€â”€ -->
<main class="newspaper-body" id="mainContent">
  <div class="loading-page">
    <div class="loading-spinner">â¦</div>
    <div class="loading-text">Typesetting the morning editionâ€¦</div>
  </div>
</main>

<!-- â”€â”€â”€ SWIPEABLE DECK VIEWER â”€â”€â”€ -->
<div class="deck-overlay" id="deckOverlay">

  <!-- Top bar -->
  <div class="deck-topbar">
    <button class="deck-close" id="deckClose">âœ•</button>
    <div class="deck-counter" id="deckCounter">1 / 1</div>
    <div class="deck-dots" id="deckDots"></div>
  </div>

  <!-- Track â€” slides live here -->
  <div class="deck-track-wrap">
    <div class="deck-track" id="deckTrack"></div>
  </div>

  <!-- Arrow nav -->
  <button class="deck-arrow deck-arrow-prev" id="deckPrev">â€¹</button>
  <button class="deck-arrow deck-arrow-next" id="deckNext">â€º</button>

</div>

<!-- â”€â”€â”€ FOOTER â”€â”€â”€ -->
<footer class="site-footer">A Quote A Day Â· Student Contributions Â· Est. 2026</footer>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const REPO_OWNER = "AndrewVeda";
const REPO_NAME  = "a-quote-a-day";
const QUOTES_DIR = "quotes";

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let allQuotes = [];      // { quote, author, contributor, department, about, date: Date, dateStr: "YYYY-MM-DD", filename }
let currentView = 'all';
let _lastRenderedQuotes = []; // tracks which quotes are in current view for deck context

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', async () => {
  setDateline();
  await fetchQuotes();
  setupNav();
  renderView('all');
});

function setDateline() {
  const now = new Date();
  const opts = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  document.getElementById('mastDateline').textContent = now.toLocaleDateString('en-US', opts).toUpperCase();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FETCH & PARSE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function fetchQuotes() {
  try {
    const res   = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${QUOTES_DIR}`);
    const files = await res.json();
    const mdFiles = files.filter(f => f.name.endsWith('.md'));

    const promises = mdFiles.map(async f => {
      const raw = await fetch(f.download_url).then(r => r.text());
      const q   = parseMarkdown(raw, f.name);
      return q;
    });

    const results = await Promise.all(promises);
    allQuotes = results.filter(Boolean);

    // Sort newest first
    allQuotes.sort((a, b) => b.date - a.date);

    document.getElementById('mastCount').textContent = `${allQuotes.length} quotes`;
  } catch (e) {
    console.error(e);
    document.getElementById('mainContent').innerHTML =
      '<div class="empty-state">Could not fetch the morning edition. Please check your connection.</div>';
  }
}

function parseMarkdown(md, filename) {
  const match = md.match(/---([\s\S]*?)---/);
  if (!match) return null;

  const lines = match[1].split('\n');
  const data  = {};
  lines.forEach(l => {
    const [k, ...v] = l.split(':');
    if (k && v.length) data[k.trim()] = v.join(':').trim();
  });

  // Extract date from filename: YYYY-MM-DD_...
  const dateMatch = filename.match(/^(\d{4}-\d{2}-\d{2})/);
  const dateStr   = dateMatch ? dateMatch[1] : null;
  const date      = dateStr ? new Date(dateStr + 'T00:00:00') : new Date(0);

  return {
    quote:       data.quote       || '',
    author:      data.author      || 'Unknown',
    contributor: data.contributor || 'A student',
    department:  data.department  || '',
    about:       data.what_it_means_to_me || data.about || '',
    date,
    dateStr: dateStr || 'Unknown',
    filename
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setupNav() {
  document.querySelectorAll('.nav-item').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentView = btn.dataset.view;
      renderView(currentView);
    });
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEWS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderView(view) {
  const main = document.getElementById('mainContent');
  main.innerHTML = '';

  if (!allQuotes.length) {
    main.innerHTML = '<div class="empty-state">No quotes found in the archive.</div>';
    return;
  }

  if (view === 'all')         renderAll(main);
  else if (view === 'today')  renderToday(main);
  else if (view === 'authors')      renderGrouped(main, 'author');
  else if (view === 'departments')  renderGrouped(main, 'department');
}

/* â”€â”€â”€ ALL: chronological newspaper â”€â”€â”€ */
function renderAll(container) {
  const todayStr = todayDateStr();
  const todayQs  = allQuotes.filter(q => q.dateStr === todayStr);
  const pastQs   = allQuotes.filter(q => q.dateStr !== todayStr);
  _lastRenderedQuotes = allQuotes;

  // TODAY SECTION
  if (todayQs.length) {
    const todayBanner = el('div', 'today-banner', 'â˜…  Today\'s Edition  â˜…');
    container.appendChild(todayBanner);
    renderTodaySection(container, todayQs);
  }

  // PAST: group by date
  if (pastQs.length) {
    // Section header
    const sectionLabel = makeSectionLabel('Past Contributions', 'Archive');
    container.appendChild(sectionLabel);

    const byDate = groupByDate(pastQs);

    byDate.forEach(({ dateStr, quotes }) => {
      const group = el('div', 'date-group');

      // Date header
      const dateHeader = makeArchiveDateHeader(dateStr, quotes.length);
      group.appendChild(dateHeader);

      // Grid of quotes
      const cols = Math.min(quotes.length, 3);
      const grid = el('div', `col-grid cols-${cols}`);

      quotes.forEach((q, i) => {
        const card = makeQCard(q, i);
        grid.appendChild(card);
        card.style.animationDelay = `${i * 60}ms`;
      });

      group.appendChild(grid);
      container.appendChild(group);
    });
  }

  if (!todayQs.length && !pastQs.length) {
    container.innerHTML = '<div class="empty-state">No quotes in the archive yet.</div>';
  }
}

/* â”€â”€â”€ TODAY ONLY â”€â”€â”€ */
function renderToday(container) {
  const todayStr = todayDateStr();
  const todayQs  = allQuotes.filter(q => q.dateStr === todayStr);
  _lastRenderedQuotes = todayQs;

  if (!todayQs.length) {
    container.innerHTML = `<div class="empty-state">No quotes submitted today yet.<br><br><a href="https://andrewveda.github.io/a-quote-a-day/submissions" style="color:var(--ink);font-style:normal;font-family:var(--sans);font-size:12px;letter-spacing:2px;">âœï¸ Be the first â€” Add yours</a></div>`;
    return;
  }

  const banner = el('div', 'today-banner', `â˜…  Today's Edition  â€”  ${todayQs.length} contribution${todayQs.length !== 1 ? 's' : ''}  â˜…`);
  container.appendChild(banner);
  renderTodaySection(container, todayQs);
}

function renderTodaySection(container, qs) {
  // Hero: first quote
  const hero = makeTodayHero(qs[0], 0);
  container.appendChild(hero);

  // Rest in columns
  if (qs.length > 1) {
    const rest = qs.slice(1);
    const cols = Math.min(rest.length, 3);
    const grid = el('div', `col-grid cols-${cols}`);
    rest.forEach((q, i) => {
      // Alternate between full card and pull-quote style
      const card = (i % 3 === 1 && rest.length > 2) ? makePullQuote(q, i + 1) : makeQCard(q, i + 1);
      grid.appendChild(card);
      card.style.animationDelay = `${(i + 1) * 80}ms`;
    });
    container.appendChild(grid);
  }
}

/* â”€â”€â”€ GROUPED (author / department) â”€â”€â”€ */
function renderGrouped(container, field) {
  const label = field === 'author' ? 'By Author' : 'By Department';
  container.appendChild(makeSectionLabel(label, `${allQuotes.length} quotes`));
  _lastRenderedQuotes = allQuotes;

  const groups = {};
  allQuotes.forEach(q => {
    const key = q[field] || 'Unknown';
    if (!groups[key]) groups[key] = [];
    groups[key].push(q);   // original reference, not a copy
  });

  const sortedKeys = Object.keys(groups).sort((a, b) => {
    // Sort by count desc, then alpha
    return groups[b].length - groups[a].length || a.localeCompare(b);
  });

  sortedKeys.forEach(key => {
    const qs = groups[key];
    const dateHeader = makeArchiveDateHeader(key, qs.length, true);
    container.appendChild(dateHeader);

    const cols = Math.min(qs.length, 3);
    const grid = el('div', `col-grid cols-${cols}`);
    qs.forEach((q, i) => {
      const card = makeQCard(q, i);
      grid.appendChild(card);
      card.style.animationDelay = `${i * 60}ms`;
    });
    container.appendChild(grid);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILDERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function makeTodayHero(q, idx) {
  const div = document.createElement('div');
  div.className = 'today-hero';
  div.innerHTML = `
    <div class="hero-kicker">âœ¦ Featured Quote of the Day</div>
    <div class="hero-quote-text">"${escHtml(q.quote)}"</div>
    <div class="hero-byline">â€” <strong>${escHtml(q.author)}</strong></div>
    <div class="hero-student-name">${escHtml(q.contributor)}</div>
    <div class="hero-student-dept">${escHtml(q.department || '')}</div>
    ${q.about ? `<div class="hero-about">${escHtml(q.about)}</div>` : ''}
  `;
  div.addEventListener('click', () => openModal(q, 1));
  div.style.cursor = 'pointer';
  return div;
}

function makeQCard(q, displayIdx) {
  const div = document.createElement('div');
  div.className = 'q-card';
  div.innerHTML = `
    <div class="q-card-num">No. ${displayIdx + 1}</div>
    <div class="q-card-text">"${escHtml(q.quote)}"</div>
    <div class="q-card-rule"></div>
    <div class="q-card-author">â€” ${escHtml(q.author)}</div>
    <div class="q-card-student-name">${escHtml(q.contributor)}</div>
    <div class="q-card-student-dept">${escHtml(q.department || '')}</div>
    <div class="q-card-meta">${q.dateStr !== 'Unknown' ? formatDateFull(q.dateStr) : ''}</div>
    ${q.about ? `<div class="q-card-about">${escHtml(q.about)}</div>` : ''}
  `;
  div.addEventListener('click', () => openModal(q, displayIdx + 1));
  return div;
}

function makePullQuote(q, displayIdx) {
  const div = document.createElement('div');
  div.className = 'pull-quote';
  div.innerHTML = `
    <div class="pull-quote-text">"${escHtml(q.quote)}"</div>
    <div class="pull-quote-attr">â€” ${escHtml(q.author)}</div>
  `;
  div.addEventListener('click', () => openModal(q, displayIdx + 1));
  return div;
}

function makeSectionLabel(title, sub) {
  const wrap = document.createElement('div');
  wrap.className = 'section-label';
  wrap.innerHTML = `
    <div class="section-label-text">${escHtml(title)}</div>
    <div class="section-label-rule"></div>
    <div class="section-label-date">${escHtml(sub)}</div>
  `;
  return wrap;
}

function makeArchiveDateHeader(dateStrOrLabel, count, isLabel = false) {
  const wrap = document.createElement('div');
  wrap.className = 'archive-date-header';

  let calHTML;
  if (isLabel) {
    const initials = dateStrOrLabel.split(' ').map(w => w[0] || '').join('').slice(0, 2).toUpperCase();
    calHTML = `
      <div class="archive-date-cal">
        <div class="archive-date-cal-month" style="font-size:16px;opacity:1;">${escHtml(initials)}</div>
      </div>
    `;
  } else {
    const d = new Date(dateStrOrLabel + 'T00:00:00');
    const month = d.toLocaleString('en-US', { month: 'short' }).toUpperCase();
    const day   = d.getDate();
    const year  = d.getFullYear();
    calHTML = `
      <div class="archive-date-cal">
        <div class="archive-date-cal-month">${month}</div>
        <div class="archive-date-cal-day">${day}</div>
        <div class="archive-date-cal-year">${year}</div>
      </div>
    `;
  }

  const fullLabel = isLabel ? dateStrOrLabel : formatDateFull(dateStrOrLabel);
  const subLabel  = `${count} contribution${count !== 1 ? 's' : ''}`;

  wrap.innerHTML = `
    ${calHTML}
    <div class="archive-date-info">
      <div class="archive-date-label">${escHtml(fullLabel)}</div>
      <div class="archive-date-sub">${subLabel}</div>
    </div>
  `;
  return wrap;
}

/* openModal is defined later in the share section */


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DECK VIEWER ENGINE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _deckQuotes  = [];
let _deckIdx     = 0;
let _currentShareQuote = null;

function openModal(q) {
  // Use the current view's quote list; fall back to allQuotes
  const pool = _lastRenderedQuotes.length ? _lastRenderedQuotes : allQuotes;
  // Find by reference first, then by quote text as fallback
  let idx = pool.indexOf(q);
  if (idx === -1) idx = pool.findIndex(p => p.quote === q.quote && p.contributor === q.contributor);
  if (idx === -1) idx = 0;
  openDeck(pool, idx);
}

function openDeck(quotes, startIdx) {
  _deckQuotes = quotes;

  // Build slides
  const track = document.getElementById('deckTrack');
  track.innerHTML = '';
  track.style.transition = 'none';
  track.style.transform  = 'translateX(0)';

  quotes.forEach((q, i) => {
    const slide = document.createElement('div');
    slide.className = 'deck-slide';

    const globalNum = allQuotes.findIndex(p => p.quote === q.quote && p.contributor === q.contributor) + 1;
    const hasAbout  = !!q.about;

    slide.innerHTML = `
      <div class="deck-card">
        <div class="dc-kicker">Quote #${globalNum} Â· ${formatDateFull(q.dateStr)}</div>
        <div class="dc-quote">"${escHtml(q.quote)}"</div>
        <div class="dc-author-name">${escHtml(q.author)}</div>
        <div class="dc-author-role">Quoted Author</div>
        <div class="dc-contrib-box">
          <div class="dc-contrib-label">Contributed by</div>
          <div class="dc-contrib-name">${escHtml(q.contributor)}</div>
          <div class="dc-contrib-dept">${escHtml(q.department || '')}</div>
          ${hasAbout ? `
            <div class="dc-contrib-divider"></div>
            <div class="dc-about-label">What this means to me</div>
            <div class="dc-about-text">${escHtml(q.about)}</div>
          ` : ''}
        </div>
        <div class="dc-actions">
          <a class="dc-btn primary dc-btn-discuss" href="https://github.com/AndrewVeda/a-quote-a-day/discussions?discussions_q=Quote+%23${globalNum}" target="_blank" rel="noopener">ğŸ’¬ Discuss</a>
          <button class="dc-btn dc-btn-wa">ğŸ“² WhatsApp</button>
          <button class="dc-btn dc-btn-img">ğŸ“¸ Share</button>
          <a class="dc-btn" href="https://andrewveda.github.io/a-quote-a-day/submissions" target="_blank">âœï¸ Add a Quote</a>
        </div>
      </div>`;

    slide.querySelector('.dc-btn-wa').addEventListener('click', () => {
      _currentShareQuote = q; shareToWhatsApp();
    });
    slide.querySelector('.dc-btn-img').addEventListener('click', () => {
      _currentShareQuote = q; shareAsImage();
    });

    track.appendChild(slide);
  });

  // Build dots
  const dotsWrap = document.getElementById('deckDots');
  dotsWrap.innerHTML = '';
  if (quotes.length > 1) {
    quotes.forEach((_, i) => {
      const d = document.createElement('div');
      d.className = 'deck-dot';
      d.addEventListener('click', () => deckGoTo(i));
      dotsWrap.appendChild(d);
    });
  }

  // Show overlay before jumping so layout is painted
  document.getElementById('deckOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';

  // Jump after a frame so track width is known
  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      deckGoTo(startIdx, false);
    });
  });
}

function deckGoTo(i, animate = true) {
  const track = document.getElementById('deckTrack');
  _deckIdx = Math.max(0, Math.min(i, _deckQuotes.length - 1));
  _currentShareQuote = _deckQuotes[_deckIdx];

  track.style.transition = animate ? 'transform 0.38s cubic-bezier(.4,0,.2,1)' : 'none';
  track.style.transform  = `translateX(-${_deckIdx * 100}%)`;

  document.getElementById('deckCounter').textContent = `${_deckIdx + 1} / ${_deckQuotes.length}`;
  document.querySelectorAll('.deck-dot').forEach((d, j) => d.classList.toggle('active', j === _deckIdx));
  document.getElementById('deckPrev').disabled = (_deckIdx === 0);
  document.getElementById('deckNext').disabled = (_deckIdx === _deckQuotes.length - 1);
}

function closeDeck() {
  document.getElementById('deckOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

// Controls
document.getElementById('deckClose').addEventListener('click', closeDeck);
document.getElementById('deckPrev').addEventListener('click', () => deckGoTo(_deckIdx - 1));
document.getElementById('deckNext').addEventListener('click', () => deckGoTo(_deckIdx + 1));

document.addEventListener('keydown', e => {
  if (!document.getElementById('deckOverlay').classList.contains('open')) return;
  if (e.key === 'Escape')     closeDeck();
  if (e.key === 'ArrowLeft')  deckGoTo(_deckIdx - 1);
  if (e.key === 'ArrowRight') deckGoTo(_deckIdx + 1);
});

// Touch swipe
(function () {
  const overlay = document.getElementById('deckOverlay');
  let sx = 0, sy = 0, dragging = false;

  overlay.addEventListener('touchstart', e => {
    sx = e.touches[0].clientX;
    sy = e.touches[0].clientY;
    dragging = false;
  }, { passive: true });

  overlay.addEventListener('touchmove', e => {
    dragging = true;
  }, { passive: true });

  overlay.addEventListener('touchend', e => {
    if (!dragging) return;
    const dx = e.changedTouches[0].clientX - sx;
    const dy = e.changedTouches[0].clientY - sy;
    if (Math.abs(dx) < 40 || Math.abs(dx) < Math.abs(dy) * 1.2) return;
    if (dx < 0) deckGoTo(_deckIdx + 1);
    else         deckGoTo(_deckIdx - 1);
  }, { passive: true });
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function todayDateStr() {
  const now = new Date();
  const y   = now.getFullYear();
  const m   = String(now.getMonth() + 1).padStart(2, '0');
  const d   = String(now.getDate()).padStart(2, '0');
  return `${y}-${m}-${d}`;
}

function formatDateFull(dateStr) {
  if (!dateStr || dateStr === 'Unknown') return 'Unknown Date';
  const d = new Date(dateStr + 'T00:00:00');
  return d.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
}

function groupByDate(quotes) {
  const map = {};
  quotes.forEach(q => {
    const key = q.dateStr || 'Unknown';
    if (!map[key]) map[key] = [];
    map[key].push(q);
  });
  // Sort dates descending
  return Object.keys(map)
    .sort((a, b) => b.localeCompare(a))
    .map(dateStr => ({ dateStr, quotes: map[dateStr] }));
}

function el(tag, className, text = '') {
  const d = document.createElement(tag);
  d.className = className;
  if (text) d.textContent = text;
  return d;
}

function escHtml(s) {
  if (!s) return '';
  return String(s)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARE AS IMAGE / WHATSAPP
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// _currentShareQuote is set by the deck engine whenever a slide is active

function populateShareCard(q) {
  document.getElementById('sc-quote').textContent  = `"${q.quote}"`;
  document.getElementById('sc-author').textContent = q.author;
  document.getElementById('sc-date').textContent   = formatDateFull(q.dateStr);
  document.getElementById('sc-contrib').textContent = q.contributor;
  document.getElementById('sc-dept').textContent   = q.department || '';

  const aboutWrap = document.getElementById('sc-about-wrap');
  if (q.about) {
    document.getElementById('sc-about').textContent = q.about;
    aboutWrap.style.display = 'block';
  } else {
    aboutWrap.style.display = 'none';
  }
}

async function generateImage() {
  const q = _currentShareQuote;
  if (!q) return null;

  populateShareCard(q);
  const node = document.getElementById('shareCard');

  await new Promise(r => requestAnimationFrame(r));
  await new Promise(r => setTimeout(r, 100));

  const canvas = await html2canvas(node, {
    scale: 2,
    useCORS: true,
    backgroundColor: '#ffffff',
    logging: false,
    width: 540,
    height: 960,
  });

  // JPEG at 88% quality â€” good balance of quality vs file size for WhatsApp
  return new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.88));
}

async function shareAsImage() {
  // Update the active slide's share button for feedback
  const activeSlide = document.querySelector('.deck-slide:nth-child(' + (_deckIdx + 1) + ')');
  const btn = activeSlide ? activeSlide.querySelector('.dc-btn-img') : null;
  if (btn) btn.textContent = 'â³â€¦';
  try {
    const blob = await generateImage();
    if (btn) btn.textContent = 'ğŸ“¸ Share';
    if (!blob) throw new Error('No blob');
    const file = new File([blob], 'a-quote-a-day.jpg', { type: 'image/jpeg' });
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({ files: [file], title: 'A Quote A Day' });
    } else {
      const url = URL.createObjectURL(blob);
      const a   = document.createElement('a');
      a.href = url; a.download = 'a-quote-a-day.jpg'; a.click();
      setTimeout(() => URL.revokeObjectURL(url), 2000);
    }
  } catch (err) {
    console.error(err);
    if (btn) btn.textContent = 'ğŸ“¸ Share';
    if (err.name !== 'AbortError') alert('Could not generate image. Try a different browser.');
  }
}

async function shareToWhatsApp() {
  const q = _currentShareQuote;
  if (!q) return;
  const activeSlide = document.querySelector('.deck-slide:nth-child(' + (_deckIdx + 1) + ')');
  const btn = activeSlide ? activeSlide.querySelector('.dc-btn-wa') : null;
  if (btn) btn.textContent = 'â³â€¦';
  try {
    const blob = await generateImage();
    if (btn) btn.textContent = 'ğŸ“² WhatsApp';
    const file = new File([blob], 'a-quote-a-day.jpg', { type: 'image/jpeg' });
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({
        files: [file],
        title: 'A Quote A Day',
        text: `"${q.quote}"\nâ€” ${q.author}\n\nContributed by ${q.contributor}\n\nâœ¨ A Quote A Day Â· SRM VEC\nhttps://andrewveda.github.io/SRM-VEC-English-PWA`,
      });
      return;
    }
    const text = encodeURIComponent(`"${q.quote}"\nâ€” ${q.author}\n\nContributed by ${q.contributor}\n\nâœ¨ A Quote A Day Â· SRM VEC\nhttps://andrewveda.github.io/SRM-VEC-English-PWA`);
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href = url; a.download = 'a-quote-a-day.jpg'; a.click();
    setTimeout(() => URL.revokeObjectURL(url), 2000);
    setTimeout(() => window.open(`https://wa.me/?text=${text}`, '_blank'), 400);
  } catch (err) {
    if (btn) btn.textContent = 'ğŸ“² WhatsApp';
    if (err.name !== 'AbortError') {
      const text = encodeURIComponent(`"${q.quote}"\nâ€” ${q.author}\n\nContributed by ${q.contributor}\n\nâœ¨ A Quote A Day Â· SRM VEC\nhttps://andrewveda.github.io/SRM-VEC-English-PWA`);
      window.open(`https://wa.me/?text=${text}`, '_blank');
    }
  }
}
</script>

<!-- â”€â”€â”€ SHARE CARD â€” 9:16 portrait, mobile-optimised â”€â”€â”€ -->
<div id="shareCard" style="
  position: fixed;
  left: -9999px;
  top: 0;
  width: 540px;
  height: 960px;
  background: #ffffff;
  font-family: 'Raleway', sans-serif;
  overflow: hidden;
  display: flex;
  flex-direction: column;
">

  <!-- Gold top accent bar -->
  <div style="height:6px;background:linear-gradient(90deg,#c9a84c,#e8c97a);flex-shrink:0;"></div>

  <!-- Header -->
  <div style="padding:28px 36px 20px;flex-shrink:0;border-bottom:1px solid rgba(0,0,0,0.07);">
    <div style="font-family:'UnifrakturMaguntia',serif;font-size:32px;color:#2a2a2a;letter-spacing:1px;line-height:1;">A Quote A Day</div>
    <div id="sc-date" style="font-family:'DM Mono',monospace;font-size:10px;color:#b0a99f;letter-spacing:2px;text-transform:uppercase;margin-top:5px;"></div>
  </div>

  <!-- Main content â€” grows to fill -->
  <div style="flex:1;display:flex;flex-direction:column;justify-content:center;padding:36px 36px 24px;position:relative;">

    <!-- Faint decorative quote mark -->
    <div style="font-family:'Playfair Display',serif;font-size:200px;line-height:0.75;color:#c9a84c;opacity:0.07;position:absolute;top:20px;left:24px;user-select:none;pointer-events:none;">"</div>

    <!-- Kicker -->
    <div style="font-family:'DM Mono',monospace;font-size:9px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#7A0019;margin-bottom:20px;">âœ¦ Student Contribution</div>

    <!-- Quote -->
    <div id="sc-quote" style="
      font-family:'Playfair Display',serif;
      font-size:26px;
      font-style:italic;
      font-weight:400;
      line-height:1.55;
      color:#2a2a2a;
      border-left:4px solid #c9a84c;
      padding-left:20px;
      margin-bottom:32px;
      position:relative;
      z-index:1;
    "></div>

    <!-- Author â€” biggest name -->
    <div id="sc-author" style="
      font-family:'Playfair Display',serif;
      font-size:30px;
      font-weight:900;
      color:#2a2a2a;
      line-height:1.1;
      margin-bottom:4px;
    "></div>
    <div style="font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:#b0a99f;margin-bottom:28px;">Quoted Author</div>

    <!-- Contributor gold box -->
    <div style="background:linear-gradient(135deg,rgba(201,168,76,0.12),rgba(201,168,76,0.04));border:1px solid rgba(201,168,76,0.35);border-left:4px solid #c9a84c;border-radius:12px;padding:18px 20px;">
      <div style="font-family:'DM Mono',monospace;font-size:8px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:#c9a84c;margin-bottom:6px;">Contributed by</div>
      <div id="sc-contrib" style="font-family:'Playfair Display',serif;font-size:22px;font-weight:900;color:#2a2a2a;line-height:1.1;"></div>
      <div id="sc-dept" style="font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:#c9a84c;margin-top:4px;opacity:0.85;"></div>
      <div id="sc-about-wrap" style="display:none;">
        <div style="height:1px;background:rgba(201,168,76,0.3);margin:14px 0;"></div>
        <div style="font-family:'DM Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:#c9a84c;margin-bottom:7px;">What this means to me</div>
        <div id="sc-about" style="font-family:'Raleway',sans-serif;font-style:italic;font-size:13px;line-height:1.6;color:#7a766f;"></div>
      </div>
    </div>
  </div>

  <!-- Footer with PWA link -->
  <div style="flex-shrink:0;border-top:1px solid rgba(0,0,0,0.06);padding:16px 36px;display:flex;align-items:center;justify-content:space-between;">
    <div style="font-family:'DM Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;color:#b0a99f;">SRM VEC Â· English Dept</div>
    <div style="font-family:'DM Mono',monospace;font-size:8px;color:#c9a84c;letter-spacing:0.5px;">andrewveda.github.io/SRM-VEC-English-PWA</div>
  </div>

  <!-- Gold bottom accent bar -->
  <div style="height:4px;background:linear-gradient(90deg,#c9a84c,#e8c97a);flex-shrink:0;"></div>

</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</body>
</html>
